# Travel Planner API

LangGraph κΈ°λ° AI μ—¬ν–‰ ν”λλ„ API - Azure Maps λ° K-Means ν΄λ¬μ¤ν„°λ§μ„ ν™μ©ν• μµμ  μ—¬ν–‰ μΌμ • μƒμ„±

## π― μ£Όμ” κΈ°λ¥

### π—ΊοΈ μ§€λ¥ν• κ²½λ΅ μµμ ν™”

- **ν•μ΄λΈλ¦¬λ“ κ±°λ¦¬ κ³„μ‚°**: Haversine(μ§μ„  κ±°λ¦¬) + Azure Maps(μ‹¤μ  λ„λ΅ κ±°λ¦¬)
- **μλ™ μΊμ‹±**: λ°λ³µ κ³„μ‚° λ°©μ§€λ΅ API λΉ„μ© μ κ° (μΊμ‹ ν¬κΈ°: 5000κ°)
- **κµν†µμλ‹¨ μ„ νƒ μµμ…**: κ° μ΄λ™λ§λ‹¤ λ„λ³΄(κΈ°λ³Έκ°’)/λ€μ¤‘κµν†µ μ„ νƒ κ°€λ¥
  - λ„λ³΄: Haversine κ±°λ¦¬/μ‹κ°„ (κΈ°λ³Έκ°’)
  - λ€μ¤‘κµν†µ: Azure Maps μ‹¤μ‹κ°„ μ†μ”μ‹κ°„
  - ν”„λ΅ νΈμ—”λ“μ—μ„ μ„ νƒ μ‹ μΌμ •μ μ‹κ°„ μλ™ μ¬κ³„μ‚°

### π§  K-Means ν΄λ¬μ¤ν„°λ§

- **μ§€μ—­λ³„ μΌμ • κ·Έλ£Ήν™”**: κ°€κΉμ΄ μ¥μ†λ“¤μ„ κ°™μ€ λ‚ μ— μλ™ λ°°μΉ
- **μ΄λ™ μ‹κ°„ μµμ†ν™”**: ν•λ£¨ λ™μ„ μ„ μµμ ν™”ν•μ—¬ ν¨μ¨μ μΈ μ—¬ν–‰ κ³„ν
- **μ™Έλ¶€ λΌμ΄λΈλ¬λ¦¬ λ¶ν•„μ”**: μμ Python κµ¬ν„μΌλ΅ λΉ„μ© 0μ›

### β΅ μ„±λ¥ μµμ ν™”

- **TTL μΊμ‹±**: 1μ‹κ°„ λ‹¨μ„ μλ™ μΊμ‹ (λ©”λ¨λ¦¬ λ„μ λ°©μ§€)
- **λ™μ‹μ„± μ•μ „**: asyncio.LockμΌλ΅ Race condition λ°©μ§€
- **λ³‘λ ¬ κ±°λ¦¬ κ³„μ‚°**: μ—¬λ¬ μ¥μ† κ°„ κ±°λ¦¬λ¥Ό λ™μ‹μ— κ³„μ‚°
- **λΉ λ¥Έ μ‘λ‹µ μ†λ„**: μΊμ‹ ννΈ μ‹ 99% μ„±λ¥ ν–¥μƒ

### π¨ μ™μ† κΈ°λ° λ™μ„  μµμ ν™”

- **λ©”μΈ νΈν…” μ„¤μ •**: νΈν…”μ΄ μμΌλ©΄ λ¨λ“  λ‚ μ μ‹μ‘μ μΌλ΅ μλ™ μ„¤μ •
- **νΈν…” λ³€κ²½**: μ„ νƒν• νΈν…”μ„ λ³€κ²½ν•λ©΄ κΈ°μ΅΄ μ¥μ†λ“¤ μ μ§€ν•λ©° μΌμ • μ¬κ³„μ‚°
- **μ¥μ† κµμ²΄**: μΌμ • μ¤‘ νΉμ • μ¥μ†λ¥Ό λ‹¤λ¥Έ μ¥μ†λ΅ κµμ²΄ κ°€λ¥

## π“ μ„±λ¥ μ§€ν‘

| ν•­λ© | κ°μ„ λ„ |
|------|--------|
| DB μΏΌλ¦¬ κ°μ† | 90% β†“ (μΊμ‹ ννΈ μ‹) |
| μ‘λ‹µμ‹κ°„ λ‹¨μ¶• | 10~99% β†‘ (μƒν™©λ³„) |
| κ±°λ¦¬ μΊμ‹ ν¬κΈ° | 400% β†‘ (1000β†’5000) |
| λ©”λ¨λ¦¬ μ¦κ°€ | +800KB (λ―Έλ―Έ) |

## π“ ν”„λ΅μ νΈ κµ¬μ΅°

```
BackEnd-main/
β”β”€β”€ server.py                  # FastAPI λ©”μΈ μ„λ²„
β”β”€β”€ db_connection.py           # PostgreSQL μ—°κ²°
β”β”€β”€ routers/
β”‚   β”β”€β”€ travel.py              # μ—¬ν–‰ κ³„ν API μ—”λ“ν¬μΈνΈ
β”‚   β””β”€β”€ chat.py                # μ±„ν… API μ—”λ“ν¬μΈνΈ
β”β”€β”€ services/
β”‚   β”β”€β”€ search_service.py      # μ¥μ† κ²€μƒ‰ + TTL μΊμ‹±
β”‚   β”β”€β”€ route_optimizer.py     # κ²½λ΅ μµμ ν™” + κ±°λ¦¬ μΊμ‹±
β”‚   β”β”€β”€ itinerary_service.py   # μΌμ • μƒμ„±
β”‚   β””β”€β”€ travel_service.py      # LangGraph κΈ°λ° ν”λλ„
β”β”€β”€ tools/
β”‚   β””β”€β”€ travel_tools.py        # LangChain λ„κµ¬
β”β”€β”€ schemas/
β”‚   β””β”€β”€ travel.py              # μ”μ²­/μ‘λ‹µ λ¨λΈ
β”β”€β”€ sample_data.json           # ν΄λ°± λ°μ΄ν„°
β””β”€β”€ .env                       # ν™κ²½ λ³€μ
```

## β™οΈ ν™κ²½ λ³€μ μ„¤μ •

`.env` νμΌμ— λ‹¤μ λ³€μλ¥Ό μ„¤μ •ν•μ„Έμ”:

```bash
# Azure OpenAI
AZURE_OPENAI_ENDPOINT=your_endpoint
AZURE_OPENAI_API_KEY=your_key
AZURE_OPENAI_API_VERSION=2024-02-15-preview
AZURE_CHAT_DEPLOYMENT=gpt-4
AZURE_EMBEDDING_DEPLOYMENT=text-embedding-ada-002

# Azure Maps (μ„ νƒμ‚¬ν•­)
AZURE_MAPS_SUBSCRIPTION_KEY=your_maps_key
USE_AZURE_MAPS=true

# PostgreSQL
DATABASE_URL=postgresql://user:password@host:5432/database
```

## π€ μ„¤μΉ λ° μ‹¤ν–‰

```bash
# μμ΅΄μ„± μ„¤μΉ
uv sync

# μ„λ²„ μ‹¤ν–‰
python3 server.py
```

μ„λ²„: http://localhost:8000  
Swagger UI: http://localhost:8000/docs

## π“΅ API μ—”λ“ν¬μΈνΈ

### GET /travel/destinations
μ§€μ›ν•λ” μ—¬ν–‰μ§€ λ©λ΅

**μ‘λ‹µ:**
```json
{
  "destinations": ["μ„μΈ", "μ μ£Όλ„", "λ¶€μ‚°"]
}
```

### GET /travel/types
μ§€μ›ν•λ” μ—¬ν–‰ νƒ€μ…

**μ‘λ‹µ:**
```json
{
  "types": ["νλ§", "μμ‹", "κ΄€κ΄‘", "μ•΅ν‹°λΉ„ν‹°"]
}
```

### POST /travel/plans
μ—¬ν–‰ μΌμ • μƒμ„±

**μ”μ²­:**
```json
{
  "destination": "μ„μΈ",
  "start_date": "2025-12-20",
  "travel_styles": ["μμ—°", "λ§›μ§‘"],
  "duration_days": 2,
  "budget": "100λ§μ›",
  "requirements": [],
  "include_debug": false
}
```

**μ‘λ‹µ:** `itinerary` λ°°μ—΄ ν¬ν•¨ μΌμ • μ •λ³΄

### POST /travel/plans/update-hotel
νΈν…” λ³€κ²½ ν›„ μΌμ • μ¬κ³„μ‚°

### POST /travel/plans/replace-place
μ¥μ† κµμ²΄ ν›„ μΌμ • μ¬κ³„μ‚°

### POST /chat/travel
λ€ν™”ν• μ—¬ν–‰ κ³„ν (LangGraph)

## π› οΈ κΈ°μ  μ¤νƒ

- **FastAPI**: κ³ μ„±λ¥ μ›Ή ν”„λ μ„μ›ν¬
- **PostgreSQL**: μ—¬ν–‰ λ°μ΄ν„° μ €μ¥μ†
- **SQLAlchemy**: ORM
- **LangGraph**: λ€ν™”ν• AI μ›ν¬ν”λ΅μ°
- **Azure OpenAI**: GPT-4 κΈ°λ° μμ—°μ–΄ μ²λ¦¬
- **Azure Maps**: κ²½λ΅ μµμ ν™”
- **asyncio**: λΉ„λ™κΈ° I/O μ²λ¦¬

## π“ ν”„λ΅ νΈμ—”λ“ κ°€μ΄λ“

π‘‰ **[FRONTEND_GUIDE.md](./FRONTEND_GUIDE.md)** λ¥Ό μ°Έμ΅°ν•μ„Έμ”.

μ£Όμ” λ‚΄μ©:
- API μ‚¬μ©λ²•
- λ°μ΄ν„° κµ¬μ΅°
- μ”μ²­/μ‘λ‹µ μμ‹
- React/Vue μμ 

## π”§ ν•µμ‹¬ μ•κ³ λ¦¬μ¦

### K-Means ν΄λ¬μ¤ν„°λ§
μ¥μ†λ“¤μ„ μΌμλ³„λ΅ μµμ μΌλ΅ κ·Έλ£Ήν™”ν•©λ‹λ‹¤.

### ν•μ΄λΈλ¦¬λ“ κ±°λ¦¬ κ³„μ‚°
- **1.5km λ―Έλ§**: Haversine (λΉ λ¦„, λ¬΄λ£)
- **1.5km μ΄μƒ**: Azure Maps (μ •ν™•ν•¨, κµν†µ λ°μ)
- **μΊμ‹**: λ™μΌ κ²½λ΅ μ¬κ³„μ‚° λ°©μ§€

### Greedy Nearest Neighbor
ν„μ¬ μ„μΉμ—μ„ κ°€μ¥ κ°€κΉμ΄ λ―Έλ°©λ¬Έ μ¥μ†λ¥Ό μμ°¨μ μΌλ΅ μ„ νƒν•©λ‹λ‹¤.

## π“ λΌμ΄μ„ μ¤

MIT
